<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>สวีรู้ทันสโตรก</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body class="p-3">

  <main id="app-container">
    <div class="text-center">
      <div class="spinner-border"></div>
      <p>กำลังโหลดหน้าหลัก...</p>
    </div>
  </main>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    // --- ตั้งค่า LIFF ID ---
    const liffId = "2005789397-pklo1yJP";

    // รายชื่อเพจ .html ที่จะโหลด
    const allowedPages = ["index", "risk", "learning", "asm", "profile"];
    const defaultPage  = "index";

    document.addEventListener("DOMContentLoaded", initApp);

    async function initApp() {
      const container = document.getElementById("app-container");
      try {
        // 1) init LIFF
        await liff.init({ liffId });
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        // 2) อ่าน ?page=
        const params = new URLSearchParams(window.location.search);
        let page = params.get("page") || defaultPage;
        if (!allowedPages.includes(page)) page = defaultPage;

        // 3) โหลดเพจ
        await loadPage(page);

      } catch (err) {
        container.innerHTML = `
          <div class="alert alert-danger">
            เกิดข้อผิดพลาดในการเริ่มต้น: ${err.message}
          </div>`;
      }
    }

    async function loadPage(pageName) {
      const container = document.getElementById("app-container");
      try {
        const res = await fetch(`${pageName}.html`);
        if (!res.ok) {
          throw new Error(`ไม่สามารถโหลดไฟล์ ${pageName}.html (status ${res.status})`);
        }
        // นำ HTML มาแสดง
        const html = await res.text();
        container.innerHTML = html;

        // --- รัน <script> ที่มากับไฟล์นั้น ๆ ---
        const scripts = container.querySelectorAll("script");
        scripts.forEach(oldScript => {
          const newScript = document.createElement("script");
          // ถ้ามี src ให้ย้ายลิงก์
          if (oldScript.src) {
            newScript.src = oldScript.src;
          } else {
            newScript.textContent = oldScript.textContent;
          }
          document.body.appendChild(newScript);
          oldScript.remove();
        });

      } catch (err) {
        container.innerHTML = `
          <div class="alert alert-danger">
            เกิดข้อผิดพลาด: ${err.message}
          </div>`;
      }
    }
  </script>
</body>
</html>
