<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>หน้าโปรไฟล์</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="container mt-4">
    
    <h3>โปรไฟล์และประวัติการประเมิน</h3>
    <hr>
    
    <div id="profile-info" class="mb-4">
      <img id="profile-picture" src="https://via.placeholder.com/100" class="rounded-circle mb-2" alt="Profile Picture" style="width: 100px; height: 100px;">
      <h5 id="display-name">Loading...</h5>
      <p class="text-muted" id="user-id">User ID: Loading...</p>
    </div>

    <h4>ประวัติการทำแบบประเมิน</h4>
    <div id="assessment-history">
      <p>กำลังโหลดข้อมูลประวัติ...</p>
    </div>

    <hr>
    <h4>เมนูอื่นๆ</h4>
    <div class="d-grid gap-2">
      <a href="https://liff.line.me/2005789397-pklo1yJP?page=risk" class="btn btn-primary">ไปหน้าประเมินความเสี่ยง</a>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      async function main() {
        try {
          await liff.init({ liffId: "2005789397-pklo1yJP" });
          if (!liff.isLoggedIn()) {
            liff.login();
            return;
          }

          const profile = await liff.getProfile();
          document.getElementById('profile-picture').src = profile.pictureUrl;
          document.getElementById('display-name').textContent = profile.displayName;
          document.getElementById('user-id').textContent = `User ID: ${profile.userId}`;
          
          // --- ฟังก์ชันสำหรับดึงข้อมูลประวัติ (ต้องเขียนเพิ่ม) ---
          // fetchHistory(profile.userId);

        } catch (e) {
          console.error("LIFF Initialization failed", e);
        }
      }
      main();

      // ตัวอย่างฟังก์ชันดึงข้อมูล (คุณต้องไปเขียนโค้ดฝั่ง Server-side ใน GAS เพิ่ม)
      function fetchHistory(userId) {
        // google.script.run.withSuccessHandler(showHistory).getHistoryByUserId(userId);
      }
      
      function showHistory(historyData) {
        const historyDiv = document.getElementById('assessment-history');
        // นำ historyData มาแสดงผลในรูปแบบ HTML
      }

    </script>
  </body>
</html>